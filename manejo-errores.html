<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manejo de Errores - Consumo de APIs</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/manejo-errores.css">
</head>
<body>
    <!-- Barra de navegaci√≥n principal -->
    <nav class="navbar">
        <div class="container">
            <!-- Contenedor para el logo o marca -->
            <div class="nav-brand"></div>
            <!-- Bot√≥n hamburguesa para men√∫ m√≥vil -->
            <button class="nav-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <!-- Men√∫ de navegaci√≥n con enlaces a todas las p√°ginas -->
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Inicio</a></li>
                <li><a href="fundamentos.html" class="nav-link">Fundamentos</a></li>
                <li><a href="urls-endpoints.html" class="nav-link">URLs & Endpoints</a></li>
                <li><a href="metodos-http.html" class="nav-link">M√©todos HTTP</a></li>
                <li><a href="codigos-respuesta.html" class="nav-link">C√≥digos HTTP</a></li>
                <li><a href="asincronia.html" class="nav-link">Asincron√≠a JS</a></li>
                <li><a href="manejo-errores.html" class="nav-link active">Manejo de Errores</a></li>
                <li><a href="demos.html" class="nav-link btn-demo">Demos</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero de p√°gina con breadcrumbs y t√≠tulo -->
    <section class="page-hero">
        <div class="container">
            <!-- Breadcrumbs para navegaci√≥n jer√°rquica -->
            <div class="breadcrumb">
                <a href="index.html">Inicio</a>
                <span>/</span>
                <span>Manejo de Errores y Estados de Carga</span>
            </div>
            <!-- T√≠tulo y descripci√≥n de la p√°gina -->
            <h1 class="page-title">Manejo de Errores y Estados de Carga</h1>
            <p class="page-subtitle">Aprende a manejar respuestas de APIs e implementar estados de carga, √©xito y error en tu interfaz</p>
        </div>
    </section>

    <!-- Contenido principal -->
    <main class="main-content">
        <div class="container">
            <!-- Secci√≥n: Introducci√≥n - Importancia del manejo de errores -->
            <section class="content-section">
                <h2 class="section-heading">¬øPor Qu√© es Importante el Manejo de Errores?</h2>
                <!-- Caja introductoria con texto explicativo -->
                <div class="intro-box">
                    <p class="intro-text">
                        Cuando trabajamos con APIs, las cosas no siempre salen como esperamos. El servidor puede estar ca√≠do, 
                        la conexi√≥n puede fallar, o el usuario puede enviar datos incorrectos. Un buen manejo de errores es 
                        esencial para crear aplicaciones robustas y proporcionar una experiencia de usuario profesional.
                    </p>
                </div>

                <!-- Grid con tres razones principales para manejar errores -->
                <div class="importance-grid">
                    <!-- Raz√≥n 1: Experiencia de usuario -->
                    <div class="importance-card">
                        <div class="importance-icon">üë§</div>
                        <h3>Mejor Experiencia de Usuario</h3>
                        <p>Los usuarios necesitan saber qu√© est√° pasando: si algo est√° cargando, si fue exitoso, o si hubo un error.</p>
                    </div>
                    <!-- Raz√≥n 2: Debugging -->
                    <div class="importance-card">
                        <div class="importance-icon">üêõ</div>
                        <h3>Debugging M√°s F√°cil</h3>
                        <p>Mensajes de error claros te ayudan a identificar y solucionar problemas r√°pidamente.</p>
                    </div>
                    <!-- Raz√≥n 3: Robustez -->
                    <div class="importance-card">
                        <div class="importance-icon">üõ°Ô∏è</div>
                        <h3>Aplicaciones Robustas</h3>
                        <p>Prevenir que tu aplicaci√≥n se rompa cuando algo sale mal.</p>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n: Comportamiento de fetch() con errores -->
            <section class="content-section">
                <h2 class="section-heading">Comportamiento de fetch() con Errores</h2>
                
                <!-- Caja de advertencia importante sobre fetch() -->
                <div class="warning-box">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <div class="warning-content">
                        <h3>¬°Importante!</h3>
                        <p>Seg√∫n la documentaci√≥n de MDN, <code>fetch()</code> <strong>solo rechaza la promesa cuando ocurre un error de red</strong>, 
                        como cuando el usuario est√° offline o hay un problema de DNS.</p>
                        <p>Esto significa que <code>fetch()</code> <strong>NO rechaza la promesa</strong> para errores HTTP como 404 o 500. 
                        La promesa se resuelve normalmente, y t√∫ debes verificar manualmente el estado de la respuesta.</p>
                    </div>
                </div>

                <!-- Comparaci√≥n lado a lado: comportamiento incorrecto vs correcto -->
                <div class="example-comparison">
                    <!-- Columna izquierda: Ejemplo incorrecto -->
                    <div class="comparison-column">
                        <h4 class="incorrect-label">‚ùå Comportamiento Inesperado</h4>
                        <pre><code>fetch('http://example.com/api/500')
  .then(() => console.log('ok'))
  .catch(() => console.log('error'));

// Resultado: Imprime "ok" üò±
// Aunque el servidor devolvi√≥ 500!</code></pre>
                        <p class="explanation">El <code>catch</code> no se ejecuta porque no hubo error de red, solo un c√≥digo HTTP 500.</p>
                    </div>

                    <!-- Columna derecha: Ejemplo correcto -->
                    <div class="comparison-column">
                        <h4 class="correct-label">‚úÖ Comportamiento Correcto</h4>
                        <pre><code>fetch('http://example.com/api/500')
  .then(response => {
    if (!response.ok) {
      throw new Error('Error HTTP');
    }
    return response.json();
  })
  .catch(() => console.log('error'));

// Resultado: Imprime "error" ‚úì</code></pre>
                        <p class="explanation">Verificamos <code>response.ok</code> y lanzamos un error manualmente si no est√° en el rango 200-299.</p>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n: M√©todos para manejar errores -->
            <section class="content-section">
                <h2 class="section-heading">M√©todos para Manejar Errores</h2>

                <!-- M√©todo 1: Verificar response.ok -->
                <div class="method-box">
                    <h3>M√©todo 1: Verificar <code>response.ok</code></h3>
                    <p>La propiedad <code>ok</code> es <code>true</code> si el c√≥digo de estado HTTP est√° en el rango 200-299.</p>
                    <!-- Ejemplo de c√≥digo con async/await -->
                    <pre><code>async function getData() {
  try {
    const response = await fetch('https://api.example.com/data');
    
    if (!response.ok) {
      throw new Error(`Error HTTP: ${response.status}`);
    }
    
    const data = await response.json();
    console.log(data);
  } catch (error) {
    console.error('Error:', error.message);
  }
}</code></pre>
                </div>

                <!-- M√©todo 2: Verificar c√≥digos de estado espec√≠ficos -->
                <div class="method-box">
                    <h3>M√©todo 2: Verificar C√≥digos de Estado Espec√≠ficos</h3>
                    <p>Puedes manejar diferentes c√≥digos de estado de manera espec√≠fica.</p>
                    <!-- Ejemplo con switch para manejar diferentes c√≥digos HTTP -->
                    <pre><code>async function loginUser(credentials) {
  try {
    const response = await fetch('https://api.example.com/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(credentials)
    });
    
    const data = await response.json();
    
    switch(response.status) {
      case 200:
        console.log('Login exitoso');
        return data;
      case 401:
        throw new Error('Credenciales incorrectas');
      case 404:
        throw new Error('Endpoint no encontrado');
      case 500:
        throw new Error('Error del servidor');
      default:
        throw new Error(`Error: ${response.status}`);
    }
  } catch (error) {
    console.error('Error en login:', error.message);
    throw error;
  }
}</code></pre>
                </div>

                <!-- M√©todo 3: Funci√≥n helper reutilizable -->
                <div class="method-box">
                    <h3>M√©todo 3: Funci√≥n Reutilizable de Manejo de Errores</h3>
                    <p>Crea una funci√≥n helper para manejar errores de forma consistente.</p>
                    <!-- Ejemplo de funci√≥n reutilizable -->
                    <pre><code>function handleResponse(response) {
  if (!response.ok) {
    throw Error(response.statusText);
  }
  return response;
}

// Uso:
fetch('https://api.example.com/data')
  .then(handleResponse)
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error('Error:', error));</code></pre>
                </div>
            </section>

            <!-- Secci√≥n: Estados de la interfaz de usuario -->
            <section class="content-section">
                <h2 class="section-heading">Estados de la Interfaz de Usuario</h2>
                
                <p class="intro-text">
                    Cuando hacemos peticiones a una API, la interfaz debe reflejar tres estados principales:
                </p>

                <!-- Grid con los tres estados principales de la UI -->
                <div class="states-overview">
                    <!-- Estado 1: Carga -->
                    <div class="state-card loading-state">
                        <div class="state-icon">‚è≥</div>
                        <h3>Estado de Carga</h3>
                        <p>Indica que la petici√≥n est√° en proceso</p>
                        <ul>
                            <li>Mostrar spinner o skeleton</li>
                            <li>Deshabilitar botones</li>
                            <li>Mensaje "Cargando..."</li>
                        </ul>
                    </div>

                    <!-- Estado 2: √âxito -->
                    <div class="state-card success-state">
                        <div class="state-icon">‚úÖ</div>
                        <h3>Estado de √âxito</h3>
                        <p>La petici√≥n se complet√≥ exitosamente</p>
                        <ul>
                            <li>Mostrar los datos obtenidos</li>
                            <li>Mensaje de confirmaci√≥n</li>
                            <li>Actualizar la UI</li>
                        </ul>
                    </div>

                    <!-- Estado 3: Error -->
                    <div class="state-card error-state">
                        <div class="state-icon">‚ùå</div>
                        <h3>Estado de Error</h3>
                        <p>La petici√≥n fall√≥</p>
                        <ul>
                            <li>Mensaje de error claro</li>
                            <li>Bot√≥n para reintentar</li>
                            <li>Sugerencias de soluci√≥n</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n: Implementaci√≥n completa con estados -->
            <section class="content-section">
                <h2 class="section-heading">Implementaci√≥n Completa con Estados</h2>

                <div class="implementation-box">
                    <h3>Ejemplo: Lista de Usuarios con Manejo Completo</h3>
                    
                    <!-- Estructura HTML b√°sica -->
                    <h4>HTML</h4>
                    <pre><code>&lt;div id="app"&gt;
  &lt;button id="loadBtn"&gt;Cargar Usuarios&lt;/button&gt;
  &lt;div id="status"&gt;&lt;/div&gt;
  &lt;div id="users"&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>

                    <!-- Implementaci√≥n JavaScript completa con manejo de estados -->
                    <h4>JavaScript</h4>
                    <pre><code>// Variables de estado
let isLoading = false;
let users = [];
let error = null;

// Elementos del DOM
const loadBtn = document.getElementById('loadBtn');
const statusDiv = document.getElementById('status');
const usersDiv = document.getElementById('users');

// Funci√≥n para actualizar la UI seg√∫n el estado
function updateUI() {
  // Estado de carga
  if (isLoading) {
    loadBtn.disabled = true;
    statusDiv.innerHTML = `
      &lt;div class="loading"&gt;
        &lt;div class="spinner"&gt;&lt;/div&gt;
        &lt;p&gt;Cargando usuarios...&lt;/p&gt;
      &lt;/div&gt;
    `;
    usersDiv.innerHTML = '';
    return;
  }
  
  // Estado de error
  if (error) {
    loadBtn.disabled = false;
    statusDiv.innerHTML = `
      &lt;div class="error"&gt;
        &lt;p&gt;‚ùå Error: ${error}&lt;/p&gt;
        &lt;button onclick="loadUsers()"&gt;Reintentar&lt;/button&gt;
      &lt;/div&gt;
    `;
    usersDiv.innerHTML = '';
    return;
  }
  
  // Estado de √©xito
  if (users.length > 0) {
    loadBtn.disabled = false;
    statusDiv.innerHTML = `
      &lt;div class="success"&gt;
        ‚úÖ ${users.length} usuarios cargados exitosamente
      &lt;/div&gt;
    `;
    
    usersDiv.innerHTML = users.map(user => `
      &lt;div class="user-card"&gt;
        &lt;h3&gt;${user.name}&lt;/h3&gt;
        &lt;p&gt;${user.email}&lt;/p&gt;
      &lt;/div&gt;
    `).join('');
  }
}

// Funci√≥n para cargar usuarios
async function loadUsers() {
  // Activar estado de carga
  isLoading = true;
  error = null;
  users = [];
  updateUI();
  
  try {
    const response = await fetch('https://jsonplaceholder.typicode.com/users');
    
    // Verificar si la respuesta es exitosa
    if (!response.ok) {
      throw new Error(`Error HTTP: ${response.status}`);
    }
    
    // Parsear JSON
    const data = await response.json();
    
    // Actualizar estado de √©xito
    users = data;
    isLoading = false;
    updateUI();
    
  } catch (err) {
    // Actualizar estado de error
    isLoading = false;
    
    // Distinguir tipos de error
    if (err instanceof TypeError) {
      error = 'Error de red. Verifica tu conexi√≥n a internet.';
    } else if (err.message.includes('HTTP')) {
      error = `El servidor respondi√≥ con un error: ${err.message}`;
    } else {
      error = err.message;
    }
    
    updateUI();
  }
}

// Event listener
loadBtn.addEventListener('click', loadUsers);</code></pre>
                </div>
            </section>

            <!-- Secci√≥n: Mejores pr√°cticas -->
            <section class="content-section">
                <h2 class="section-heading">Mejores Pr√°cticas</h2>
                
                <!-- Grid con 6 mejores pr√°cticas -->
                <div class="best-practices-grid">
                    <!-- Pr√°ctica 1: Verificar response.ok -->
                    <div class="practice-card">
                        <div class="practice-number">1</div>
                        <h3>Siempre Verifica <code>response.ok</code></h3>
                        <p>No conf√≠es en que <code>catch</code> maneje todos los errores HTTP.</p>
                    </div>

                    <!-- Pr√°ctica 2: Manejar errores de parsing JSON -->
                    <div class="practice-card">
                        <div class="practice-number">2</div>
                        <h3>Maneja Errores de Parsing JSON</h3>
                        <p>El m√©todo <code>.json()</code> puede fallar si la respuesta no es JSON v√°lido.</p>
                        <pre><code>try {
  const data = await response.json();
} catch (e) {
  if (e instanceof SyntaxError) {
    console.error('Respuesta no es JSON v√°lido');
  }
}</code></pre>
                    </div>

                    <!-- Pr√°ctica 3: Mensajes de error claros -->
                    <div class="practice-card">
                        <div class="practice-number">3</div>
                        <h3>Proporciona Mensajes Claros</h3>
                        <p>Los usuarios no t√©cnicos no entienden "Error 500". Usa mensajes amigables.</p>
                        <div class="message-examples">
                            <p class="bad-message">‚ùå "Error: 500"</p>
                            <p class="good-message">‚úÖ "El servidor est√° experimentando problemas. Intenta de nuevo m√°s tarde."</p>
                        </div>
                    </div>

                    <!-- Pr√°ctica 4: Implementar timeouts -->
                    <div class="practice-card">
                        <div class="practice-number">4</div>
                        <h3>Implementa Timeouts</h3>
                        <p>No dejes que el usuario espere indefinidamente.</p>
                        <pre><code>const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 5000);

fetch(url, { signal: controller.signal })
  .then(response => {
    clearTimeout(timeoutId);
    return response.json();
  })
  .catch(error => {
    if (error.name === 'AbortError') {
      console.error('Timeout: la petici√≥n tard√≥ demasiado');
    }
  });</code></pre>
                    </div>

                    <!-- Pr√°ctica 5: Acciones de recuperaci√≥n -->
                    <div class="practice-card">
                        <div class="practice-number">5</div>
                        <h3>Ofrece Acciones de Recuperaci√≥n</h3>
                        <p>Siempre proporciona una forma de que el usuario intente de nuevo o tome otra acci√≥n.</p>
                    </div>

                    <!-- Pr√°ctica 6: Registrar errores -->
                    <div class="practice-card">
                        <div class="practice-number">6</div>
                        <h3>Registra Errores para Debugging</h3>
                        <p>Guarda informaci√≥n detallada de errores para ayudar en el desarrollo.</p>
                        <pre><code>catch (error) {
  console.error('Error details:', {
    message: error.message,
    stack: error.stack,
    timestamp: new Date().toISOString()
  });
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n: Tipos comunes de errores -->
            <section class="content-section">
                <h2 class="section-heading">Tipos Comunes de Errores</h2>

                <!-- Grid con 4 tipos de errores comunes -->
                <div class="error-types">
                    <!-- Tipo 1: Errores de red -->
                    <div class="error-type-card network-error">
                        <h3>üåê Errores de Red</h3>
                        <p><strong>Cu√°ndo ocurren:</strong> Sin conexi√≥n a internet, DNS fallido, timeout</p>
                        <p><strong>C√≥mo manejar:</strong></p>
                        <pre><code>if (error instanceof TypeError) {
  showMessage('Error de conexi√≥n. Verifica tu internet.');
}</code></pre>
                    </div>

                    <!-- Tipo 2: Errores HTTP -->
                    <div class="error-type-card http-error">
                        <h3>üì° Errores HTTP (4xx, 5xx)</h3>
                        <p><strong>Cu√°ndo ocurren:</strong> El servidor responde pero con un c√≥digo de error</p>
                        <p><strong>C√≥mo manejar:</strong></p>
                        <pre><code>if (!response.ok) {
  if (response.status === 404) {
    showMessage('Recurso no encontrado');
  } else if (response.status >= 500) {
    showMessage('Error del servidor');
  }
}</code></pre>
                    </div>

                    <!-- Tipo 3: Errores de parsing -->
                    <div class="error-type-card parsing-error">
                        <h3>üìã Errores de Parsing</h3>
                        <p><strong>Cu√°ndo ocurren:</strong> La respuesta no es JSON v√°lido</p>
                        <p><strong>C√≥mo manejar:</strong></p>
                        <pre><code>try {
  const data = await response.json();
} catch (e) {
  if (e instanceof SyntaxError) {
    showMessage('Respuesta inv√°lida del servidor');
  }
}</code></pre>
                    </div>

                    <!-- Tipo 4: Errores de autenticaci√≥n -->
                    <div class="error-type-card auth-error">
                        <h3>üîê Errores de Autenticaci√≥n</h3>
                        <p><strong>Cu√°ndo ocurren:</strong> Token inv√°lido o expirado (401, 403)</p>
                        <p><strong>C√≥mo manejar:</strong></p>
                        <pre><code>if (response.status === 401) {
  logout();
  showMessage('Sesi√≥n expirada. Inicia sesi√≥n de nuevo');
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n: Ejemplo visual interactivo -->
            <section class="content-section">
                <h2 class="section-heading">Ejemplo Visual Interactivo</h2>
                
                <div class="visual-demo">
                    <div class="demo-description">
                        <p>A continuaci√≥n se muestra c√≥mo se ven los tres estados en una aplicaci√≥n real:</p>
                    </div>

                    <!-- Demo del estado de carga -->
                    <div class="demo-state">
                        <h3>Estado de Carga</h3>
                        <div class="demo-ui loading-demo">
                            <div class="spinner"></div>
                            <p>Cargando usuarios...</p>
                            <button disabled>Cargar Usuarios</button>
                        </div>
                    </div>

                    <!-- Demo del estado de √©xito -->
                    <div class="demo-state">
                        <h3>Estado de √âxito</h3>
                        <div class="demo-ui success-demo">
                            <div class="success-message">‚úÖ 10 usuarios cargados exitosamente</div>
                            <div class="user-list">
                                <div class="user-item">üë§ Juan P√©rez - juan@example.com</div>
                                <div class="user-item">üë§ Mar√≠a Garc√≠a - maria@example.com</div>
                                <div class="user-item">üë§ Carlos L√≥pez - carlos@example.com</div>
                            </div>
                            <button>Recargar</button>
                        </div>
                    </div>

                    <!-- Demo del estado de error -->
                    <div class="demo-state">
                        <h3>Estado de Error</h3>
                        <div class="demo-ui error-demo">
                            <div class="error-message">
                                <p>‚ùå Error al cargar usuarios</p>
                                <p class="error-detail">No se pudo conectar al servidor. Verifica tu conexi√≥n a internet.</p>
                            </div>
                            <button>Reintentar</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Navegaci√≥n entre p√°ginas (anterior y siguiente) -->
            <nav class="page-navigation">
                <a href="asincronia.html" class="nav-btn nav-prev">
                    ‚Üê Asincron√≠a en JavaScript
                </a>
                <a href="demos.html" class="nav-btn nav-next">
                    Demos Interactivas ‚Üí
                </a>
            </nav>
        </div>
    </main>

     <!-- Pie de p√°gina -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Proyecto Acad√©mico</h4>
                    <p>ISW-512 Dise√±o de Aplicaciones Web<br>Universidad T√©cnica Nacional<br>2025 - Ciclo III</p>
                </div>
                <div class="footer-section">
                    <h4>Navegaci√≥n</h4>
                    <ul class="footer-links">
                        <li><a href="fundamentos.html">Fundamentos</a></li>
                        <li><a href="urls-endpoints.html">URLs & Endpoints</a></li>
                        <li><a href="metodos-http.html">M√©todos HTTP</a></li>
                        <li><a href="codigos-respuesta.html">C√≥digos HTTP</a></li>
                        <li><a href="asincronia.html">Asincron√≠a JS</a></li>
                        <li><a href="manejo-errores.html">Manejo de Errores</a></li>
                        <li><a href="demos.html">Demos</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Funcionalidad del men√∫ m√≥vil
        const navToggle = document.querySelector('.nav-toggle');
        const navMenu = document.querySelector('.nav-menu');

        // Alterna la visibilidad del men√∫ al hacer clic en el bot√≥n hamburguesa
        navToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            navToggle.classList.toggle('active');
        });

        // Cierra el men√∫ m√≥vil cuando se hace clic fuera de √©l
        document.addEventListener('click', (e) => {
            if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
                navMenu.classList.remove('active');
                navToggle.classList.remove('active');
            }
        });

        // Animaci√≥n fade-in al hacer scroll: observa cuando las secciones entran en el viewport
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        // Crea un observador que a√±ade la clase fade-in cuando los elementos son visibles
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, observerOptions);

        // Aplica el observer a todas las secciones de contenido
        document.querySelectorAll('.content-section').forEach(section => {
            observer.observe(section);
        });
    </script>
</body>
</html>